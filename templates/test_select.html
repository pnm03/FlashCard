{% extends "base.html" %}
{% block content %}
<style>
  .container-flex {
    display: flex;
  }
  .left-panel, .right-panel {
    flex: 1;
    padding: 20px;
  }
  .right-panel {
    border-left: 1px solid #ccc;
    max-height: 600px;
    overflow-y: auto;
  }
  .form-group {
    margin-bottom: 20px;
  }
</style>

<form method="post" action="{{ url_for('test_select') }}" autocomplete="off" id="testForm">
  <div class="container-flex">
    <!-- Panel bên trái: Các ô chọn khóa, số câu hỏi, kiểu sắp xếp -->
    <div class="left-panel">
      <h2>Chọn Bộ Flashcard Kiểm Tra</h2>
      <div class="form-group">
        <label for="big_deck">Chọn Khóa Lớn:</label>
        <select id="big_deck" name="big_deck" class="form-control">
          <option value="all">Tất cả</option>
          {% for deck in decks %}
            <option value="{{ deck.big_deck }}">{{ deck.big_deck }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="form-group" id="subdeck-container">
        <label>Chọn Khóa Nhỏ:</label>
        <div id="sub_deck_list">
          <!-- Danh sách checkbox của sub_deck sẽ được load tại đây -->
        </div>
      </div>
      <div class="form-group">
        <label for="num_questions">Số câu hỏi:</label>
        <input type="number" id="num_questions" name="num_questions" min="1" value="5" class="form-control">
      </div>
      <div class="form-group">
        <label>Chọn kiểu sắp xếp:</label>
        <div>
          <label><input type="radio" name="order_mode" value="sequential" checked> Không xáo trộn (lần lượt)</label>
        </div>
        <div>
          <label><input type="radio" name="order_mode" value="random"> Xáo trộn (random)</label>
        </div>
      </div>
      <div class="form-group">
        <label>
          <input type="checkbox" name="only_english" checked> Chỉ nhập Tiếng Anh (luôn hiển thị Tiếng Việt)
        </label>
      </div>
    </div>
    <!-- Panel bên phải: Danh sách từ (theo tiếng Anh) để người dùng tích chọn -->
    <div class="right-panel" id="rightPanel">
      <h3>Chọn từ muốn kiểm tra</h3>
      <div id="word_list">
        <!-- Danh sách từ sẽ được load ở đây -->
      </div>
    </div>
  </div>
  <button type="submit" class="submit-btn">Bắt đầu Kiểm Tra</button>
</form>

<script>
  // Khi chọn khóa lớn, load danh sách khóa nhỏ và cập nhật danh sách từ
  document.getElementById('big_deck').addEventListener('change', function() {
    let selectedBig = this.value;
    let subDeckList = document.getElementById('sub_deck_list');
    subDeckList.innerHTML = '';
    if (selectedBig === "all") {
      updateWordList();
    } else {
      fetch(`/get_subdecks?big_deck=${encodeURIComponent(selectedBig)}`)
        .then(response => response.json())
        .then(data => {
          let html = '';
          data.subdecks.forEach(function(sub) {
            html += `<label>
                      <input type="checkbox" name="sub_deck" value="${sub.name}" onchange="updateWordList()"> 
                      ${sub.name} (${sub.count} từ)
                     </label><br>`;
          });
          subDeckList.innerHTML = html;
          updateWordList();
        })
        .catch(err => console.error(err));
    }
  });

  window.onload = function() {
    updateWordList();
  };
</script>
{% endblock %}
